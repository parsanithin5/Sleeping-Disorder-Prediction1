<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sleep Disorder Prediction System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>Sleep Disorder Prediction System</h1>

<form method="POST">

<!-- ================= BASIC DETAILS ================= -->
<div class="box">
    <h3>Basic Details</h3>
    Age:
    <input type="number" name="age" required>

    Gender (0 = Female, 1 = Male):
    <input type="number" name="gender" required>
</div>

<!-- ================= SLEEP & ACTIVITY ================= -->
<div class="box">
    <h3>Sleep & Activity</h3>
    Sleep Duration (hours):
    <input type="number" step="0.1" id="sleep" name="sleep_duration" required>

    Physical Activity Level:
    <input type="number" name="physical_activity" required>

    Daily Steps:
    <input type="number" id="steps" name="daily_steps" required>
</div>

<!-- ================= BMI CALCULATOR ================= -->
<div class="box">
    <h3>BMI Calculator</h3>
    Weight (kg):
    <input type="number" id="weight">

    Height (cm):
    <input type="number" id="height">

    <button type="button" onclick="calculateBMI()">Calculate BMI</button>
    <p id="bmiResult"></p>

    <input type="hidden" name="bmi_category" id="bmi_category">
</div>

<!-- ================= STRESS CALCULATOR ================= -->
<div class="box">
    <h3>Stress Level Calculator</h3>
    Heart Rate (bpm):
    <input type="number" id="heartRate" name="heart_rate" required>

    <button type="button" onclick="calculateStress()">Calculate Stress Level</button>
    <p id="stressResult"></p>

    <input type="hidden" name="stress_level" id="stress_level">
</div>

<!-- ================= BP & HABITS ================= -->
<div class="box">
    <h3>Vitals & Habits</h3>
    Systolic BP:
    <input type="number" name="systolic_bp" required>

    Diastolic BP:
    <input type="number" name="diastolic_bp" required>

    Smoking (0 = No, 1 = Yes):
    <input type="number" name="smoking" required>

    Alcohol (0 = No, 1 = Yes):
    <input type="number" name="alcohol" required>
</div>

<button type="submit">Predict Sleep Disorder</button>
</form>

<!-- ================= PREDICTION OUTPUT ================= -->
{% if prediction %}
<div class="result-box">
    <h2>Prediction Result</h2>
    <p><strong>Sleep Disorder:</strong> {{ prediction }}</p>
    <p><strong>Recommendation:</strong> {{ steps }}</p>
</div>
{% endif %}

<!-- ================= ANALYTICS DASHBOARD ================= -->
<div class="dashboard">
    <h2>Analytics Dashboard</h2>

    <img src="{{ url_for('static', filename='plots/correlation_heatmap.png') }}">
    <img src="{{ url_for('static', filename='plots/bmi_by_gender.png') }}">
    <img src="{{ url_for('static', filename='plots/activity_vs_stress.png') }}">
</div>

<!-- ================= JAVASCRIPT ================= -->
<script>
function calculateBMI() {
    let w = parseFloat(document.getElementById("weight").value);
    let h = parseFloat(document.getElementById("height").value) / 100;

    if (!w || !h) {
        alert("Please enter valid height and weight.");
        return;
    }

    let bmi = (w / (h * h)).toFixed(1);
    let category;

    if (bmi < 18.5) category = 0;
    else if (bmi < 25) category = 1;
    else if (bmi < 30) category = 2;
    else category = 3;

    document.getElementById("bmiResult").innerText =
        "BMI: " + bmi + " (Category: " + category + ")";
    document.getElementById("bmi_category").value = category;
}

function calculateStress() {
    let hr = parseFloat(document.getElementById("heartRate").value);
    let sleep = parseFloat(document.getElementById("sleep").value);
    let steps = parseFloat(document.getElementById("steps").value);

    if (!hr || !sleep || !steps) {
        alert("Please enter heart rate, sleep duration, and steps.");
        return;
    }

    let stress = Math.round((hr / 10) + ((8 - sleep) * 4) - (steps / 2000));
    stress = Math.max(1, Math.min(10, stress));

    document.getElementById("stressResult").innerText =
        "Stress Level: " + stress + "/10";
    document.getElementById("stress_level").value = stress;
}
</script>

</body>
</html>
